{"ast":null,"code":"import { resolveDirective as _resolveDirective, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nimport * as echarts from \"echarts/core\";\nimport { TitleComponent, TooltipComponent, GridComponent } from \"echarts/components\";\nimport { BarChart } from \"echarts/charts\";\nimport { CanvasRenderer } from \"echarts/renderers\";\nimport * as dayjs from \"dayjs\";\nimport { unwarp } from \"@/utils\";\nimport { onMounted, ref, onUnmounted } from \"vue\";\n/**\r\n * @description: 生成20条数据\r\n * @param {*}\r\n * @return {*}\r\n */\n\nexport default {\n  __name: 'LiveChart',\n\n  setup(__props) {\n    const dataList = () => {\n      let date = [];\n      let num = [];\n      let nowTime = new Date().getTime();\n\n      for (let i = 0; i < 30; i++) {\n        date.push(dayjs(nowTime - i * 1000).format(\"HH:mm:ss\"));\n        num.push((Math.random() * 10).toFixed(0) * 1);\n      }\n\n      return {\n        date: date.reverse(),\n        num\n      };\n    };\n\n    echarts.use([TitleComponent, TooltipComponent, GridComponent, BarChart, CanvasRenderer]);\n    const liveChart = ref(null);\n    const myChart = ref(null);\n    let timer = null;\n    let $_dataList = dataList();\n    let option = {\n      title: {\n        text: \"用户访问量\"\n      },\n      grid: {\n        left: \"0\",\n        right: \"0\",\n        top: \"10%\",\n        bottom: \"0\",\n        containLabel: true\n      },\n      tooltip: {\n        trigger: \"axis\"\n      },\n      xAxis: {\n        data: $_dataList.date\n      },\n      yAxis: {\n        type: \"value\"\n      },\n      series: [{\n        data: $_dataList.num,\n        type: \"bar\",\n        showBackground: true,\n        backgroundStyle: {\n          color: \"rgba(180, 180, 180, 0.2)\"\n        }\n      }]\n    };\n    /**\r\n     * @description: 动态数据\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n    const getNewData = myChart => {\n      unwarp(myChart.value).setOption(option);\n      timer = setInterval(() => {\n        $_dataList.date.shift();\n        $_dataList.num.shift();\n        $_dataList.date.push(dayjs(new Date().getTime()).format(\"HH:mm:ss\"));\n        $_dataList.num.push((Math.random() * 10).toFixed(0) * 1);\n        unwarp(myChart.value).setOption(option);\n      }, 1000);\n    };\n\n    onMounted(() => {\n      myChart.value = echarts.init(liveChart.value);\n      getNewData(myChart);\n    });\n    onUnmounted(() => {\n      unwarp(myChart.value).dispose();\n      clearInterval(timer);\n      timer = null;\n    });\n    return (_ctx, _cache) => {\n      const _directive_resize = _resolveDirective(\"resize\");\n\n      return _withDirectives((_openBlock(), _createElementBlock(\"div\", {\n        style: {\n          \"height\": \"400px\",\n          \"margin-top\": \"20px\"\n        },\n        ref_key: \"liveChart\",\n        ref: liveChart\n      }, null, 512)), [[_directive_resize, myChart.value]]);\n    };\n  }\n\n};","map":null,"metadata":{},"sourceType":"module"}