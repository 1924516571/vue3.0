{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport { icons, treeFindPath } from \"@/utils\";\nimport { reactive, ref, toRefs, computed, nextTick, onMounted } from \"vue\";\n/**\r\n * @description: 获取文件路径\r\n * @param {*}\r\n * @return {*}\r\n */\n\nexport default {\n  __name: 'MenuEdit',\n  props: {\n    showDialog: {\n      type: Boolean,\n      default: true\n    },\n    title: {\n      type: String,\n      default: \"添加\"\n    },\n    rowData: {\n      type: Object,\n      default: null\n    },\n    menuList: {\n      type: Array,\n      default: null\n    }\n  },\n  emits: [\"closeDialog\"],\n\n  setup(__props, {\n    expose,\n    emit\n  }) {\n    expose();\n    const props = __props;\n\n    const getfiles = () => {\n      const files = require.context(\"@/views/layoutpages\", true, /\\.vue$/);\n\n      return files.keys().map(key => {\n        return {\n          url: key.replace(/^(\\.\\/)|(\\.vue)/g, \"\"),\n          description: files(key).default.data && (files(key).default.data().description || \"无\"),\n          menus: files(key).default.data && (files(key).default.data().menus || [])\n        };\n      }).filter(key => {\n        return !key.url.includes(\"/components/\");\n      });\n    }; // import { useStore } from \"vuex\";\n\n\n    const {\n      title,\n      rowData,\n      menuList\n    } = toRefs(props);\n\n    const closeDialog = () => {\n      emit(\"closeDialog\", false);\n    };\n\n    const ve_icons = ref([]);\n    const formRef = ref(null);\n    const files = getfiles();\n    const form = reactive({\n      name: \"\",\n      type: 0,\n      parentId: -1,\n      menu: \"\",\n      url: \"\",\n      icon: \"Menu\",\n      iframe: 1,\n      sort: 1,\n      toPath: \"\"\n    });\n    const {\n      name,\n      type,\n      parentId,\n      menu,\n      url,\n      icon,\n      iframe,\n      sort,\n      toPath\n    } = toRefs(form);\n    /**\r\n     * @description: 字段重置\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n    const resetForm = () => {\n      name.value = \"\";\n      menu.value = \"\";\n      url.value = \"\";\n      icon.value = \"Menu\";\n      iframe.value = 1;\n      sort.value = 1;\n      toPath.value = \"\";\n    };\n    /**表单验证规则\r\n     * @description:\r\n     * @param {*} computed\r\n     * @return {*}\r\n     */\n\n\n    const rules = computed(() => ({\n      parentId: [{\n        required: type.value == 2 ? true : false,\n        message: \"请选择父级菜单\",\n        trigger: \"change\"\n      }],\n      name: [{\n        required: type.value != 2 ? true : false,\n        message: \"请输入菜单名称\",\n        trigger: \"blur\"\n      }],\n      menu: [{\n        required: type.value == 2 ? true : false,\n        message: \"请选择按钮\",\n        trigger: \"change\"\n      }],\n      icon: [{\n        required: type.value != 2 ? true : false,\n        message: \"请选择图标\",\n        trigger: \"change\"\n      }],\n      url: [{\n        required: type.value == 1 ? true : false,\n        pattern: /^(https?:\\/\\/)?(([a-zA-Z0-9_-])+(\\.)?)*(:\\d+)?(\\/((\\.)?(\\?)?=?&?[a-zA-Z0-9_-](\\?)?)*)*$/i,\n        message: \"url不正确\",\n        trigger: \"change\"\n      }]\n    }));\n    /**按钮目标菜单验证规则\r\n     * @description:\r\n     * @param {*} computed\r\n     * @return {*}\r\n     */\n\n    const toPathRule = computed(() => [{\n      required: changeToPath.value,\n      message: \"请选择目标菜单\",\n      trigger: \"change\"\n    }, {\n      validator: (rule, value, callback) => {\n        if (value == parentId.value) {\n          callback(new Error(\"不可以选择当前父级菜单\"));\n        } else {\n          callback();\n        }\n      },\n      trigger: \"change\"\n    }]);\n    /**\r\n     * @description:初始化赋值\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n    rowData.value && (name.value = rowData.value.name, type.value = rowData.value.type, parentId.value = rowData.value.parentId, url.value = rowData.value.url, menu.value = rowData.value.menu, icon.value = rowData.value.icon, iframe.value = rowData.value.iframe, toPath.value = rowData.value.toPath, sort.value = rowData.value.sort);\n    /**\r\n     * @description: 类型切换事件\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n    const changeType = val => {\n      nextTick(() => {\n        formRef.value.resetFields();\n      });\n      val == 2 && (icon.value = \"\");\n    };\n    /**\r\n     * @description: 图标下拉框展开事件\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n\n    const handelOptionsChange = flag => {\n      if (flag === true && ve_icons.value.length < 1) {\n        ve_icons.value = icons();\n      }\n    };\n    /**\r\n     * @description: 父级id切换事件\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n\n    const cascaderChange = () => {\n      if (type.value == 2) {\n        name.value = \"\";\n        menu.value = \"\";\n        nextTick(() => {\n          formRef.value.clearValidate(\"menu\");\n        });\n      }\n    };\n    /**\r\n     * @description:iframe切换事件\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n\n    const changeIframe = () => {\n      url.value = \"\";\n      nextTick(() => {\n        if (rowData.value && iframe.value == rowData.value.iframe) {\n          url.value = rowData.value.url;\n        }\n\n        formRef.value.clearValidate(\"url\");\n      });\n    };\n    /**\r\n     * @description:切换菜单按钮触发事件\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n\n    const changeMenu = () => {\n      name.value = menuOptions.value[menu.value][\"name\"];\n      toPath.value = \"\";\n      nextTick(() => {\n        if (rowData.value && menu.value == rowData.value.menu) {\n          toPath.value = rowData.value.toPath;\n        }\n\n        formRef.value.clearValidate(\"toPath\");\n      });\n    };\n    /**\r\n     * @description: 控制跳转菜单是否显示\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n\n    const changeToPath = computed(() => {\n      if (menuOptions.value && menu.value) {\n        return menuOptions.value[menu.value][\"toPath\"];\n      }\n\n      return false;\n    });\n    /**\r\n     * @description: 按钮的禁用函数\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n    const typeItemDisabled = computed(() => label => {\n      let flag = true;\n\n      switch (title.value) {\n        case \"编辑\":\n          if (label == type.value) {\n            flag = false;\n          }\n\n          break;\n\n        case \"添加子级\":\n          if (label == 0 || label == 1) {\n            flag = false;\n          }\n\n          break;\n\n        case \"添加按钮\":\n          if (label == 2) {\n            flag = false;\n          }\n\n          break;\n\n        default:\n          flag = false;\n          break;\n      }\n\n      return flag;\n    });\n    /**\r\n     * @description:获取menus列表\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n    const menuOptions = computed(() => {\n      // if (title.value == \"添加\" || title.value == \"添加按钮\") {\n      let _item = XE.findTree(menuList.value, item => item.id == parentId.value);\n\n      if (_item && files.find(item => item.url == _item.item.url)) {\n        return files.find(item => item.url == _item.item.url).menus;\n      } else {\n        return false;\n      } // }\n\n    });\n    /**\r\n     * @description: 已添加的按钮设为禁用\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n    const menuDisabled = computed(() => key => {\n      let _item = XE.findTree(menuList.value, item => item.id == parentId.value);\n\n      if (_item) {\n        if (rowData.value && key == rowData.value.menu) {\n          return false;\n        }\n\n        return _item.item.children && _item.item.children.find(item => item.menu == key) && true;\n      }\n    });\n    /**\r\n     * @description: 监听title\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n    const watchTitle = () => {\n      if (title.value == \"添加按钮\" || title.value == \"添加子级\") {\n        resetForm();\n        parentId.value = treeFindPath(menuList.value, data => data.id === rowData.value.id).slice(-1)[0];\n        title.value == \"添加按钮\" && (type.value = 2, icon.value = \"\");\n      }\n    };\n\n    onMounted(() => {\n      watchTitle();\n    });\n    /**\r\n     * @description:提交表单\r\n     * @param {*}\r\n     * @return {*}\r\n     */\n\n    const onSubmit = () => {\n      formRef.value.validate(async valid => {\n        if (valid) {\n          let res;\n\n          if (title.value.includes(\"添加\")) {\n            res = await VE_API.system.menuAdd(form);\n          } else {\n            res = await VE_API.system.menuEdit({\n              id: rowData.value.id,\n              ...form\n            });\n          }\n\n          const {\n            code\n          } = res;\n\n          if (code == \"00\") {\n            closeDialog();\n          }\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    };\n\n    const __returned__ = {\n      getfiles,\n      props,\n      emit,\n      title,\n      rowData,\n      menuList,\n      closeDialog,\n      ve_icons,\n      formRef,\n      files,\n      form,\n      name,\n      type,\n      parentId,\n      menu,\n      url,\n      icon,\n      iframe,\n      sort,\n      toPath,\n      resetForm,\n      rules,\n      toPathRule,\n      changeType,\n      handelOptionsChange,\n      cascaderChange,\n      changeIframe,\n      changeMenu,\n      changeToPath,\n      typeItemDisabled,\n      menuOptions,\n      menuDisabled,\n      watchTitle,\n      onSubmit,\n      icons,\n      treeFindPath,\n      reactive,\n      ref,\n      toRefs,\n      computed,\n      nextTick,\n      onMounted\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n\n};","map":{"version":3,"mappings":"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","names":["icons","treeFindPath","reactive","ref","toRefs","computed","nextTick","onMounted","getfiles","files","require","context","keys","map","key","url","replace","description","default","data","menus","filter","includes","title","rowData","menuList","props","closeDialog","emit","ve_icons","formRef","form","name","type","parentId","menu","icon","iframe","sort","toPath","resetForm","value","rules","required","message","trigger","pattern","toPathRule","changeToPath","validator","rule","callback","Error","changeType","val","resetFields","handelOptionsChange","flag","length","cascaderChange","clearValidate","changeIframe","changeMenu","menuOptions","typeItemDisabled","label","_item","XE","findTree","item","id","find","menuDisabled","children","watchTitle","slice","onSubmit","validate","valid","res","VE_API","system","menuAdd","menuEdit","code","console","log"],"sources":["C:/Users/Administrator/Desktop/vue3-element-admin-dev/src/views/layoutpages/system/components/MenuEdit.vue"],"sourcesContent":["<template>\r\n    <el-dialog :title=\"title\" append-to-body destroy-on-close :model-value=\"showDialog\" @close=\"closeDialog()\">\r\n        <!-- <span>{{ rowData }}</span> -->\r\n        <!-- 表单内容 -->\r\n        <el-form ref=\"formRef\" :model=\"form\" label-width=\"80px\" :rules=\"rules\" :validate-on-rule-change=\"false\" :inline=\"false\">\r\n            <el-form-item label=\"类型\">\r\n                <el-radio-group v-model=\"type\" @change=\"changeType\">\r\n                    <el-radio-button :disabled=\"typeItemDisabled(0)\" :label=\"0\">目录</el-radio-button>\r\n                    <el-radio-button :disabled=\"typeItemDisabled(1)\" :label=\"1\">菜单</el-radio-button>\r\n                    <el-radio-button :disabled=\"typeItemDisabled(2)\" :label=\"2\">按钮</el-radio-button>\r\n                </el-radio-group>\r\n            </el-form-item>\r\n            <el-form-item label=\"父级\" prop=\"parentId\">\r\n                <el-cascader\r\n                    style=\"width: 100%\"\r\n                    :options=\"menuList\"\r\n                    v-model=\"parentId\"\r\n                    clearable\r\n                    filterable\r\n                    :props=\"{\r\n                        expandTrigger: 'hover',\r\n                        emitPath: false,\r\n                        checkStrictly: true,\r\n                        value: 'id',\r\n                        label: 'name',\r\n                        disabled: type == 2 ? 'iframe' : 'type',\r\n                    }\"\r\n                    @change=\"cascaderChange\"\r\n                    :disabled=\"title != '添加'\"\r\n                ></el-cascader>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"排序\" v-show=\"type != 2\">\r\n                <el-input-number v-model=\"sort\" :min=\"0\" step-strictly :step=\"1\"></el-input-number>\r\n            </el-form-item>\r\n            <el-form-item label=\"名称\" prop=\"name\" v-show=\"type != 2\">\r\n                <el-input v-model=\"name\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"图标\" prop=\"icon\" v-show=\"type != 2\">\r\n                <el-select style=\"width: 100%\" v-model=\"icon\" placeholder=\"\" clearable filterable @visible-change=\"handelOptionsChange\" popper-class=\"ve_option_box\">\r\n                    <template v-slot:prefix>\r\n                        <el-icon :size=\"20\" style=\"color: #000\" v-if=\"type != 2\">\r\n                            <component :is=\"icon\" />\r\n                        </el-icon>\r\n                    </template>\r\n                    <el-option style=\"display: inline-block; height: auto; padding: 10px 11px 0px\" v-for=\"item in ve_icons\" :key=\"item\" :label=\"item\" :value=\"item\">\r\n                        <el-icon :title=\"item\" :size=\"30\">\r\n                            <component :is=\"item\" />\r\n                        </el-icon>\r\n                    </el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"iframe\" v-show=\"type == 1\" @change=\"changeIframe()\">\r\n                <el-radio-group v-model=\"iframe\">\r\n                    <el-radio-button :label=\"0\">否</el-radio-button>\r\n                    <el-radio-button :label=\"1\">是</el-radio-button>\r\n                </el-radio-group>\r\n            </el-form-item>\r\n            <el-form-item label=\"路径\" prop=\"url\" v-show=\"type == 1\">\r\n                <el-input v-if=\"iframe == 1\" v-model=\"url\" placeholder=\"请输入\" clearable></el-input>\r\n                <el-select v-else style=\"width: 100%\" v-model=\"url\" placeholder=\"\" clearable>\r\n                    <el-option style=\"height: auto\" v-for=\"item in files\" :key=\"item.url\" :label=\"item.url\" :value=\"item.url\">\r\n                        <p style=\"margin: 0\">{{ item.url }}</p>\r\n                        <span class=\"ve_select_option_slot\">描述 ：{{ item.description }}</span>\r\n                    </el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"按钮\" prop=\"menu\" v-show=\"type == 2\">\r\n                <template v-if=\"menuOptions\">\r\n                    <el-radio-group v-model=\"menu\" @change=\"changeMenu()\">\r\n                        <el-radio v-for=\"(item, key) in menuOptions\" :key=\"key\" :label=\"key\" :disabled=\"menuDisabled(key)\">\r\n                            {{ item.name }}\r\n                        </el-radio>\r\n                    </el-radio-group>\r\n                </template>\r\n                <span style=\"color: red\" v-else>该菜单下没有按钮</span>\r\n            </el-form-item>\r\n\r\n            <el-form-item v-show=\"type == 2 && changeToPath\" label=\"目标菜单\" prop=\"toPath\" :rules=\"toPathRule\">\r\n                <el-cascader\r\n                    style=\"width: 100%\"\r\n                    :options=\"menuList\"\r\n                    v-model=\"toPath\"\r\n                    clearable\r\n                    filterable\r\n                    :props=\"{\r\n                        expandTrigger: 'hover',\r\n                        emitPath: false,\r\n                        checkStrictly: true,\r\n                        value: 'id',\r\n                        label: 'name',\r\n                        disabled: 'iframe',\r\n                    }\"\r\n                ></el-cascader>\r\n            </el-form-item>\r\n        </el-form>\r\n\r\n        <template v-slot:footer>\r\n            <span>\r\n                <el-button @click=\"closeDialog()\">取消</el-button>\r\n                <el-button type=\"primary\" @click=\"onSubmit()\">确定</el-button>\r\n            </span>\r\n        </template>\r\n    </el-dialog>\r\n</template>\r\n\r\n<script setup>\r\nimport { icons, treeFindPath } from \"@/utils\";\r\nimport { reactive, ref, toRefs, computed, nextTick, onMounted } from \"vue\";\r\n/**\r\n * @description: 获取文件路径\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst getfiles = () => {\r\n    const files = require.context(\"@/views/layoutpages\", true, /\\.vue$/);\r\n    return files\r\n        .keys()\r\n        .map((key) => {\r\n            return {\r\n                url: key.replace(/^(\\.\\/)|(\\.vue)/g, \"\"),\r\n                description: files(key).default.data && (files(key).default.data().description || \"无\"),\r\n                menus: files(key).default.data && (files(key).default.data().menus || []),\r\n            };\r\n        })\r\n        .filter((key) => {\r\n            return !key.url.includes(\"/components/\");\r\n        });\r\n};\r\n// import { useStore } from \"vuex\";\r\nconst props = defineProps({\r\n    showDialog: {\r\n        type: Boolean,\r\n        default: true,\r\n    },\r\n    title: {\r\n        type: String,\r\n        default: \"添加\",\r\n    },\r\n    rowData: {\r\n        type: Object,\r\n        default: null,\r\n    },\r\n    menuList: {\r\n        type: Array,\r\n        default: null,\r\n    },\r\n});\r\nconst emit = defineEmits([\"closeDialog\"]);\r\n\r\nconst { title, rowData, menuList } = toRefs(props);\r\nconst closeDialog = () => {\r\n    emit(\"closeDialog\", false);\r\n};\r\nconst ve_icons = ref([]);\r\nconst formRef = ref(null);\r\nconst files = getfiles();\r\nconst form = reactive({\r\n    name: \"\",\r\n    type: 0,\r\n    parentId: -1,\r\n    menu: \"\",\r\n    url: \"\",\r\n    icon: \"Menu\",\r\n    iframe: 1,\r\n    sort: 1,\r\n    toPath: \"\",\r\n});\r\nconst { name, type, parentId, menu, url, icon, iframe, sort, toPath } = toRefs(form);\r\n/**\r\n * @description: 字段重置\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst resetForm = () => {\r\n    name.value = \"\";\r\n    menu.value = \"\";\r\n    url.value = \"\";\r\n    icon.value = \"Menu\";\r\n    iframe.value = 1;\r\n    sort.value = 1;\r\n    toPath.value = \"\";\r\n};\r\n\r\n/**表单验证规则\r\n * @description:\r\n * @param {*} computed\r\n * @return {*}\r\n */\r\nconst rules = computed(() => ({\r\n    parentId: [\r\n        {\r\n            required: type.value == 2 ? true : false,\r\n            message: \"请选择父级菜单\",\r\n            trigger: \"change\",\r\n        },\r\n    ],\r\n    name: [\r\n        {\r\n            required: type.value != 2 ? true : false,\r\n            message: \"请输入菜单名称\",\r\n            trigger: \"blur\",\r\n        },\r\n    ],\r\n    menu: [\r\n        {\r\n            required: type.value == 2 ? true : false,\r\n            message: \"请选择按钮\",\r\n            trigger: \"change\",\r\n        },\r\n    ],\r\n    icon: [\r\n        {\r\n            required: type.value != 2 ? true : false,\r\n            message: \"请选择图标\",\r\n            trigger: \"change\",\r\n        },\r\n    ],\r\n\r\n    url: [\r\n        {\r\n            required: type.value == 1 ? true : false,\r\n            pattern: /^(https?:\\/\\/)?(([a-zA-Z0-9_-])+(\\.)?)*(:\\d+)?(\\/((\\.)?(\\?)?=?&?[a-zA-Z0-9_-](\\?)?)*)*$/i,\r\n            message: \"url不正确\",\r\n            trigger: \"change\",\r\n        },\r\n    ],\r\n}));\r\n/**按钮目标菜单验证规则\r\n * @description:\r\n * @param {*} computed\r\n * @return {*}\r\n */\r\nconst toPathRule = computed(() => [\r\n    {\r\n        required: changeToPath.value,\r\n        message: \"请选择目标菜单\",\r\n        trigger: \"change\",\r\n    },\r\n    {\r\n        validator: (rule, value, callback) => {\r\n            if (value == parentId.value) {\r\n                callback(new Error(\"不可以选择当前父级菜单\"));\r\n            } else {\r\n                callback();\r\n            }\r\n        },\r\n        trigger: \"change\",\r\n    },\r\n]);\r\n\r\n/**\r\n * @description:初始化赋值\r\n * @param {*}\r\n * @return {*}\r\n */\r\nrowData.value &&\r\n    ((name.value = rowData.value.name),\r\n    (type.value = rowData.value.type),\r\n    (parentId.value = rowData.value.parentId),\r\n    (url.value = rowData.value.url),\r\n    (menu.value = rowData.value.menu),\r\n    (icon.value = rowData.value.icon),\r\n    (iframe.value = rowData.value.iframe),\r\n    (toPath.value = rowData.value.toPath),\r\n    (sort.value = rowData.value.sort));\r\n/**\r\n * @description: 类型切换事件\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst changeType = (val) => {\r\n    nextTick(() => {\r\n        formRef.value.resetFields();\r\n    });\r\n    val == 2 && (icon.value = \"\");\r\n};\r\n/**\r\n * @description: 图标下拉框展开事件\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst handelOptionsChange = (flag) => {\r\n    if (flag === true && ve_icons.value.length < 1) {\r\n        ve_icons.value = icons();\r\n    }\r\n};\r\n\r\n/**\r\n * @description: 父级id切换事件\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst cascaderChange = () => {\r\n    if (type.value == 2) {\r\n        name.value = \"\";\r\n        menu.value = \"\";\r\n        nextTick(() => {\r\n            formRef.value.clearValidate(\"menu\");\r\n        });\r\n    }\r\n};\r\n/**\r\n * @description:iframe切换事件\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst changeIframe = () => {\r\n    url.value = \"\";\r\n    nextTick(() => {\r\n        if (rowData.value && iframe.value == rowData.value.iframe) {\r\n            url.value = rowData.value.url;\r\n        }\r\n        formRef.value.clearValidate(\"url\");\r\n    });\r\n};\r\n/**\r\n * @description:切换菜单按钮触发事件\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst changeMenu = () => {\r\n    name.value = menuOptions.value[menu.value][\"name\"];\r\n    toPath.value = \"\";\r\n    nextTick(() => {\r\n        if (rowData.value && menu.value == rowData.value.menu) {\r\n            toPath.value = rowData.value.toPath;\r\n        }\r\n        formRef.value.clearValidate(\"toPath\");\r\n    });\r\n};\r\n/**\r\n * @description: 控制跳转菜单是否显示\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst changeToPath = computed(() => {\r\n    if (menuOptions.value && menu.value) {\r\n        return menuOptions.value[menu.value][\"toPath\"];\r\n    }\r\n    return false;\r\n});\r\n/**\r\n * @description: 按钮的禁用函数\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst typeItemDisabled = computed(() => (label) => {\r\n    let flag = true;\r\n    switch (title.value) {\r\n        case \"编辑\":\r\n            if (label == type.value) {\r\n                flag = false;\r\n            }\r\n            break;\r\n        case \"添加子级\":\r\n            if (label == 0 || label == 1) {\r\n                flag = false;\r\n            }\r\n            break;\r\n        case \"添加按钮\":\r\n            if (label == 2) {\r\n                flag = false;\r\n            }\r\n            break;\r\n\r\n        default:\r\n            flag = false;\r\n            break;\r\n    }\r\n    return flag;\r\n});\r\n\r\n/**\r\n * @description:获取menus列表\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst menuOptions = computed(() => {\r\n    // if (title.value == \"添加\" || title.value == \"添加按钮\") {\r\n    let _item = XE.findTree(menuList.value, (item) => item.id == parentId.value);\r\n    if (_item && files.find((item) => item.url == _item.item.url)) {\r\n        return files.find((item) => item.url == _item.item.url).menus;\r\n    } else {\r\n        return false;\r\n    }\r\n    // }\r\n});\r\n/**\r\n * @description: 已添加的按钮设为禁用\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst menuDisabled = computed(() => (key) => {\r\n    let _item = XE.findTree(menuList.value, (item) => item.id == parentId.value);\r\n    if (_item) {\r\n        if (rowData.value && key == rowData.value.menu) {\r\n            return false;\r\n        }\r\n        return _item.item.children && _item.item.children.find((item) => item.menu == key) && true;\r\n    }\r\n});\r\n/**\r\n * @description: 监听title\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst watchTitle = () => {\r\n    if (title.value == \"添加按钮\" || title.value == \"添加子级\") {\r\n        resetForm();\r\n        parentId.value = treeFindPath(menuList.value, (data) => data.id === rowData.value.id).slice(-1)[0];\r\n        title.value == \"添加按钮\" && ((type.value = 2), (icon.value = \"\"));\r\n    }\r\n};\r\nonMounted(() => {\r\n    watchTitle();\r\n});\r\n/**\r\n * @description:提交表单\r\n * @param {*}\r\n * @return {*}\r\n */\r\nconst onSubmit = () => {\r\n    formRef.value.validate(async (valid) => {\r\n        if (valid) {\r\n            let res;\r\n            if (title.value.includes(\"添加\")) {\r\n                res = await VE_API.system.menuAdd(form);\r\n            } else {\r\n                res = await VE_API.system.menuEdit({\r\n                    id: rowData.value.id,\r\n                    ...form,\r\n                });\r\n            }\r\n            const { code } = res;\r\n            if (code == \"00\") {\r\n                closeDialog();\r\n            }\r\n        } else {\r\n            console.log(\"error submit!!\");\r\n            return false;\r\n        }\r\n    });\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n"]},"metadata":{},"sourceType":"module"}