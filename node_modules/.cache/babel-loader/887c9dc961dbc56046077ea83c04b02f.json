{"ast":null,"code":"\"use strict\";\n\nimport axios from \"axios\";\nimport Qs from \"qs\";\nimport NProgress from \"nprogress\";\nimport { SET_TOKEN } from \"@/store/modules/app/type\"; // Full config:  https://github.com/axios/axios#request-config\n// axios.defaults.baseURL = process.env.baseURL || process.env.apiUrl || '';\n// axios.defaults.headers.common['Authorization'] = AUTH_TOKEN;\n// axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';\n\nconst install = (app, {\n  router,\n  store,\n  opt\n}) => {\n  let config = {\n    Global: true // baseURL: process.env.baseURL || process.env.apiUrl || \"\"\n    // timeout: 60 * 1000, // Timeout\n    // withCredentials: true, // Check cross-site Access-Control\n    // {\"userName\":\"Administrator\",\"pwd\":\"123456\"}\n    // userName=Administrator&pwd=123456\n\n  };\n\n  if (VE_ENV.MODE === \"production\") {\n    config.transformRequest = [data => Qs.parse(data)];\n  }\n\n  const _axios = axios.create(config);\n\n  let ve_loading;\n  let ve_message = null;\n  let loadingCount = 0; // 请求拦截\n\n  _axios.interceptors.request.use(config => {\n    console.log(config);\n    NProgress.done();\n\n    if (config.Global) {\n      NProgress.start();\n      ve_loading = app.config.globalProperties.$loading({\n        lock: true,\n        text: \"Loading\",\n        spinner: \"el-icon-loading\",\n        background: \"rgba(0,0,0,0.1)\"\n      });\n    }\n\n    loadingCount++; //*请求头添加token\n\n    const token = store.getters.token;\n    token && (config.headers.Authorization = token); // Do something before request is sent\n\n    return config;\n  }, error => {\n    // Do something with request error\n    return Promise.reject(error);\n  }); // Add a response interceptor\n  // 响应拦截\n\n\n  _axios.interceptors.response.use(response => {\n    // TODO 根据响应头更新token\n    store.dispatch(`app/${SET_TOKEN}`, new Date().getTime());\n    loadingCount--;\n\n    if (loadingCount <= 0) {\n      NProgress.done();\n      ve_loading.close();\n    }\n\n    let type = \"success\";\n\n    if (response.data.code != \"00\") {\n      type = \"error\";\n    }\n\n    if (ve_message) {\n      ve_message.close();\n      ve_message = null;\n    }\n\n    ve_message = app.config.globalProperties.$message({\n      type,\n      message: response.data.message\n    }); // Do something with response data\n\n    return response.data;\n  }, error => {\n    loadingCount--;\n\n    if (loadingCount <= 0) {\n      NProgress.done();\n      ve_loading.close();\n    }\n\n    if (error && error.response) {\n      let message = \"\";\n\n      switch (error.response.status) {\n        case 400:\n          message = \"请求错误\";\n          break;\n\n        case 401:\n          {\n            message = \"未授权，请登录\";\n            router.replace({\n              name: \"Login\"\n            });\n            break;\n          }\n\n        case 403:\n          message = \"没有权限，拒绝访问\";\n          break;\n\n        case 404:\n          message = `请求地址出错`;\n          break;\n\n        case 408:\n          message = \"请求超时\";\n          break;\n\n        case 500:\n          message = \"服务器内部错误\";\n          break;\n\n        case 501:\n          message = \"服务未实现\";\n          break;\n\n        case 502:\n          message = \"网关错误\";\n          break;\n\n        case 503:\n          message = \"服务不可用\";\n          break;\n\n        case 504:\n          message = \"网关超时\";\n          break;\n\n        case 505:\n          message = \"HTTP版本不受支持\";\n          break;\n\n        default:\n          break;\n      }\n\n      if (ve_message) {\n        ve_message.close();\n        ve_message = null;\n      }\n\n      ve_message = app.config.globalProperties.$message({\n        message,\n        type: \"error\"\n      });\n    } // Do something with response error\n\n\n    return Promise.reject(error);\n  });\n\n  const method = {\n    post: (url, p, config) => _axios.post(url, p, config),\n    get: (url, p, config) => _axios.get(url, Object.assign(config, {\n      params: p\n    }))\n  };\n  let api = {};\n\n  const files = require.context(\"@/api/modules\", false, /\\.js$/);\n\n  files.keys().forEach(key => {\n    const fileName = key.replace(/(\\.\\/|\\.js)/g, \"\");\n    api[fileName] = {};\n    let obj = files(key);\n    Object.keys(obj).forEach(item => {\n      api[fileName][item] = (p, config = {}) => method[obj[item].type](obj[item].url, p, config);\n    });\n  });\n  window[opt] = api;\n  app.config.globalProperties[opt] = api;\n};\n\nexport default {\n  install\n};","map":{"version":3,"names":["axios","Qs","NProgress","SET_TOKEN","install","app","router","store","opt","config","Global","VE_ENV","MODE","transformRequest","data","parse","_axios","create","ve_loading","ve_message","loadingCount","interceptors","request","use","console","log","done","start","globalProperties","$loading","lock","text","spinner","background","token","getters","headers","Authorization","error","Promise","reject","response","dispatch","Date","getTime","close","type","code","$message","message","status","replace","name","method","post","url","p","get","Object","assign","params","api","files","require","context","keys","forEach","key","fileName","obj","item","window"],"sources":["C:/Users/Administrator/Desktop/vue3-element-admin-dev/src/plugins/axios.js"],"sourcesContent":["\"use strict\";\n\nimport axios from \"axios\";\nimport Qs from \"qs\";\nimport NProgress from \"nprogress\";\nimport { SET_TOKEN } from \"@/store/modules/app/type\";\n\n// Full config:  https://github.com/axios/axios#request-config\n// axios.defaults.baseURL = process.env.baseURL || process.env.apiUrl || '';\n// axios.defaults.headers.common['Authorization'] = AUTH_TOKEN;\n// axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';\nconst install = (app, { router, store, opt }) => {\n    let config = {\n        Global: true,\n        // baseURL: process.env.baseURL || process.env.apiUrl || \"\"\n        // timeout: 60 * 1000, // Timeout\n        // withCredentials: true, // Check cross-site Access-Control\n        // {\"userName\":\"Administrator\",\"pwd\":\"123456\"}\n        // userName=Administrator&pwd=123456\n    };\n    if (VE_ENV.MODE === \"production\") {\n        config.transformRequest = [(data) => Qs.parse(data)];\n    }\n\n    const _axios = axios.create(config);\n    let ve_loading;\n    let ve_message = null;\n    let loadingCount = 0;\n    // 请求拦截\n    _axios.interceptors.request.use(\n        (config) => {\n            console.log(config);\n\n            NProgress.done();\n            if (config.Global) {\n                NProgress.start();\n                ve_loading = app.config.globalProperties.$loading({\n                    lock: true,\n                    text: \"Loading\",\n                    spinner: \"el-icon-loading\",\n                    background: \"rgba(0,0,0,0.1)\",\n                });\n            }\n            loadingCount++;\n            //*请求头添加token\n            const token = store.getters.token;\n            token && (config.headers.Authorization = token);\n\n            // Do something before request is sent\n            return config;\n        },\n        (error) => {\n            // Do something with request error\n            return Promise.reject(error);\n        }\n    );\n\n    // Add a response interceptor\n    // 响应拦截\n    _axios.interceptors.response.use(\n        (response) => {\n            // TODO 根据响应头更新token\n            store.dispatch(`app/${SET_TOKEN}`, new Date().getTime());\n\n            loadingCount--;\n            if (loadingCount <= 0) {\n                NProgress.done();\n                ve_loading.close();\n            }\n\n            let type = \"success\";\n            if (response.data.code != \"00\") {\n                type = \"error\";\n            }\n            if (ve_message) {\n                ve_message.close();\n                ve_message = null;\n            }\n            ve_message = app.config.globalProperties.$message({\n                type,\n                message: response.data.message,\n            });\n            // Do something with response data\n            return response.data;\n        },\n        (error) => {\n            loadingCount--;\n            if (loadingCount <= 0) {\n                NProgress.done();\n                ve_loading.close();\n            }\n            if (error && error.response) {\n                let message = \"\";\n                switch (error.response.status) {\n                    case 400:\n                        message = \"请求错误\";\n                        break;\n                    case 401: {\n                        message = \"未授权，请登录\";\n                        router.replace({\n                            name: \"Login\",\n                        });\n                        break;\n                    }\n                    case 403:\n                        message = \"没有权限，拒绝访问\";\n                        break;\n                    case 404:\n                        message = `请求地址出错`;\n                        break;\n                    case 408:\n                        message = \"请求超时\";\n                        break;\n                    case 500:\n                        message = \"服务器内部错误\";\n                        break;\n                    case 501:\n                        message = \"服务未实现\";\n                        break;\n                    case 502:\n                        message = \"网关错误\";\n                        break;\n                    case 503:\n                        message = \"服务不可用\";\n                        break;\n                    case 504:\n                        message = \"网关超时\";\n                        break;\n                    case 505:\n                        message = \"HTTP版本不受支持\";\n                        break;\n                    default:\n                        break;\n                }\n                if (ve_message) {\n                    ve_message.close();\n                    ve_message = null;\n                }\n                ve_message = app.config.globalProperties.$message({\n                    message,\n                    type: \"error\",\n                });\n            }\n            // Do something with response error\n            return Promise.reject(error);\n        }\n    );\n\n    const method = {\n        post: (url, p, config) => _axios.post(url, p, config),\n        get: (url, p, config) => _axios.get(url, Object.assign(config, { params: p })),\n    };\n\n    let api = {};\n    const files = require.context(\"@/api/modules\", false, /\\.js$/);\n    files.keys().forEach((key) => {\n        const fileName = key.replace(/(\\.\\/|\\.js)/g, \"\");\n        api[fileName] = {};\n        let obj = files(key);\n        Object.keys(obj).forEach((item) => {\n            api[fileName][item] = (p, config = {}) => method[obj[item].type](obj[item].url, p, config);\n        });\n    });\n\n    window[opt] = api;\n    app.config.globalProperties[opt] = api;\n};\n\nexport default { install };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}